<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zero Aura Store </title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* small custom overrides */
    body{ -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    .fade-enter{ opacity: 0; transform: translateY(8px); }
    .fade-enter-active{ transition: all .22s ease; opacity: 1; transform: translateY(0); }
    .toast{ transition: opacity .25s ease, transform .18s ease; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- APP container -->
  <div id="app" class="min-h-screen flex flex-col">

    <!-- TOP BAR -->
    <div class="bg-white border-b">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-10 text-sm text-gray-600">
          <div class="hidden sm:flex items-center gap-6">
            <span class="flex items-center gap-2"><svg class="w-4 h-4 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6c0 4 6 10 6 10s6-6 6-10a6 6 0 00-6-6z"></path></svg> 1234 Market St</span>
            <span class="flex items-center gap-2"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M2 2h16v16H2z"></path></svg> +1 (555) 555-5555</span>
          </div>
          <div class="flex items-center gap-4">
            <a href="#/auth" class="hover:text-indigo-600">Login</a>
            <a href="#/cart" class="hover:text-indigo-600">Cart (<span id="top-count">0</span>)</a>
          </div>
        </div>
      </div>
    </div>

    <!-- NAVBAR -->
    <header class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-5">
          <a href="#/" class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-500 to-sky-400 flex items-center justify-center text-white font-bold">A</div>
            <div>
              <div class="text-xl font-extrabold">Zero Aura Store</div>
              <div class="text-xs text-gray-500 -mt-1">Modern goods — crafted beautifully</div>
            </div>
          </a>

          <div class="hidden md:flex items-center gap-6">
            <a href="#/" class="hover:text-indigo-600">Home</a>
            <a href="#/products" class="hover:text-indigo-600">Shop</a>
            <a href="#/products" class="hover:text-indigo-600">Collections</a>
            <div>
              <input id="global-search" class="border rounded-lg px-3 py-2 w-64" placeholder="Search products..." />
            </div>
          </div>

          <div class="flex items-center gap-4">
            <a href="#/cart" class="text-gray-700 hover:text-indigo-600" aria-label="cart">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4"></path></svg>
            </a>
            <button id="mobile-menu-btn" class="md:hidden">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- MOBILE MENU -->
      <div id="mobile-menu" class="md:hidden hidden border-t bg-white">
        <div class="px-4 py-3">
          <a class="block py-2" href="#/">Home</a>
          <a class="block py-2" href="#/products">Shop</a>
          <a class="block py-2" href="#/auth">Login</a>
        </div>
      </div>
    </header>

    <!-- MAIN (dynamic) -->
    <main id="main" class="flex-1">
      <!-- content injected by JS -->
    </main>

    <!-- FOOTER -->
    <footer class="bg-white border-t">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-sm text-gray-600">
        <div class="flex flex-col md:flex-row md:justify-between gap-6">
          <div>
            <div class="font-bold">Zero Aura Store</div>
            <div class="mt-2 text-gray-500">Premium products • Fast shipping • Great support</div>
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <div class="font-semibold">Shop</div>
              <a class="block mt-2" href="#/products">All products</a>
              <a class="block mt-1" href="#/products">New arrivals</a>
            </div>
            <div>
              <div class="font-semibold">Support</div>
              <a class="block mt-2" href="#">Contact</a>
              <a class="block mt-1" href="#">Shipping</a>
            </div>
          </div>
        </div>
        <div class="mt-6 text-center text-xs text-gray-400">© <span id="year"></span> Zero Aura Store. All rights reserved.</div>
      </div>
    </footer>
  </div>

  <!-- Toast container -->
  <div id="toast-root" class="fixed right-6 bottom-6 z-50"></div>

<script>
/* -------------------------
  Single-file SPA frontend
  - hash routing
  - Tailwind styling (CDN)
  - uses backend API endpoints at same origin:
    GET  /api/products
    GET  /api/products/:slug
    POST /api/auth/login
    POST /api/auth/register
    POST /api/orders
 ------------------------- */

const API_BASE = ''; // same origin; change if backend runs elsewhere
const CART_KEY = 'cart_v1';

function getCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); }
function setCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderTopCount(); }
function addToCartItem(item){
  const c = getCart();
  const found = c.find(x=>x.productId === item.productId);
  if(found) found.quantity += item.quantity;
  else c.push(item);
  setCart(c);
  showToast('Added to cart');
}
function cartTotal(){ return getCart().reduce((s,i)=> s + (i.price * i.quantity), 0); }
function removeFromCart(pid){ setCart(getCart().filter(i=>i.productId !== pid)); }
function changeQty(pid, qty){ const c=getCart(); const it=c.find(x=>x.productId===pid); if(!it) return; it.quantity=Math.max(1, qty); setCart(c); }

function showToast(msg='Done'){
  const root = document.getElementById('toast-root');
  const el = document.createElement('div');
  el.className = 'toast bg-black text-white px-4 py-2 rounded shadow';
  el.style.opacity = '1';
  el.textContent = msg;
  root.appendChild(el);
  setTimeout(()=> { el.style.opacity = '0'; el.style.transform = 'translateY(6px)'; }, 1400);
  setTimeout(()=> el.remove(), 1700);
}

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

async function fetchProducts(){
  try{
    const r = await fetch(API_BASE + '/api/products');
    if(!r.ok) return [];
    return await r.json();
  }catch(e){ console.error(e); return []; }
}

async function fetchProductBySlug(slug){
  try{
    const r = await fetch(API_BASE + '/api/products/' + encodeURIComponent(slug));
    if(!r.ok) return null;
    return await r.json();
  }catch(e){ console.error(e); return null; }
}

/* -------------------------
   ROUTES / RENDERERS
   We'll render main content into #main
--------------------------*/

function renderShell(html){
  const main = document.getElementById('main');
  main.innerHTML = html;
  // close mobile menu on navigation
  document.getElementById('mobile-menu')?.classList.add('hidden');
  // rebind search input to route-level search where applicable
}

async function renderHome(){
  const prods = await fetchProducts();
  const featured = prods.slice(0,8);
  renderShell(`
    <section class="bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
        <div class="space-y-6">
          <div class="text-sm font-semibold uppercase text-indigo-600">Summer Collection</div>
          <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Cool looks up to <span class="text-indigo-600">40% OFF</span></h1>
          <p class="text-gray-600 max-w-xl">Hand-picked pieces for the season — modern silhouettes and premium materials.</p>
          <div class="flex gap-4">
            <a href="#/products" class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-lg shadow">Shop Now</a>
            <a href="#/products" class="inline-block border border-gray-200 px-6 py-3 rounded-lg text-gray-700">View Collection</a>
          </div>
        </div>
        <div>
          <img src="https://img.freepik.com/premium-photo/outdoor-fashion-portrait-portrait-young-stylish-man_84738-253.jpg" alt="hero" class="rounded-xl shadow-lg w-full object-cover h-[420px]" onerror="this.src='/images/placeholder.jpg'"/>
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <a class="group block bg-white rounded-lg border p-6 hover:shadow-xl transition">
          <div class="flex items-center gap-4">
            <img src="https://i.pinimg.com/originals/47/34/ce/4734ce3db2199d571a0aeffa86794b21.jpg" class="w-28 h-28 object-cover rounded" onerror="this.src='/images/placeholder.jpg'"/>
            <div>
              <div class="font-semibold">Amazing Ladies Boots</div>
              <div class="text-sm text-gray-500 mt-1">Sale up to 20%</div>
              <div class="mt-3"><span class="inline-block bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-sm">Shop</span></div>
            </div>
          </div>
        </a>
        <a class="group block bg-white rounded-lg border p-6 hover:shadow-xl transition">
          <div class="flex items-center gap-4">
            <img src="https://tse2.mm.bing.net/th/id/OIP.Amvjtu8-HkbHayq-Ca-QDgHaMm?pid=Api&P=0&h=220" class="w-28 h-28 object-cover rounded" onerror="this.src='/images/placeholder.jpg'"/>
            <div>
              <div class="font-semibold">Cool Men's Jackets</div>
              <div class="text-sm text-gray-500 mt-1">Sale up to 15%</div>
              <div class="mt-3"><span class="inline-block bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-sm">Shop</span></div>
            </div>
          </div>
        </a>
        <a class="group block bg-white rounded-lg border p-6 hover:shadow-xl transition">
          <div class="flex items-center gap-4">
            <img src="https://tse3.mm.bing.net/th/id/OIP.YBzxeFlOxzuL8ukeHgVEHwHaHa?pid=Api&P=0&h=220" class="w-28 h-28 object-cover rounded" onerror="this.src='/images/placeholder.jpg'"/>
            <div>
              <div class="font-semibold">Trendy Bags</div>
              <div class="text-sm text-gray-500 mt-1">Sale up to 70%</div>
              <div class="mt-3"><span class="inline-block bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-sm">Shop</span></div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
      <div class="flex items-center justify-between mb-6">
        <div>
          <div class="text-sm text-indigo-500">Recommended</div>
          <h2 class="text-2xl font-bold">Sale Products</h2>
        </div>
        <div><a href="#/products" class="text-indigo-600 hover:underline">View all products</a></div>
      </div>

      <div id="featured-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        ${featured.map(p => `
          <div class="bg-white rounded-lg shadow group">
            <a href="#/product?slug=${encodeURIComponent(p.slug)}">
              <div class="h-56 flex items-center justify-center overflow-hidden rounded-t-lg bg-gray-50">
                <img src="${p.image || '/images/placeholder.jpg'}" alt="${escapeHtml(p.name)}" class="w-full h-full object-contain p-6" onerror="this.src='/images/placeholder.jpg'"/>
              </div>
            </a>
            <div class="p-4">
              <a href="#/product?slug=${encodeURIComponent(p.slug)}" class="font-semibold text-gray-800 hover:text-indigo-600">${escapeHtml(p.name)}</a>
              <div class="mt-2 text-sm text-gray-500">${escapeHtml((p.description||'').slice(0,80))}</div>
              <div class="mt-4 flex items-center justify-between">
                <div class="text-indigo-600 font-bold">$${Number(p.price).toFixed(2)}</div>
                <div><button data-id="${p._id}" data-name="${escapeHtml(p.name)}" data-price="${p.price}" data-image="${p.image||'/images/placeholder.jpg'}" class="add-btn inline-block bg-indigo-600 text-white px-3 py-2 rounded">Add</button></div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    </section>
  `);

  attachAddButtons();
}

async function renderProducts(){
  const prods = await fetchProducts();
  renderShell(`
    <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">All Products</h1>
        <div class="flex items-center gap-3">
          <select id="sort-select" class="border rounded px-3 py-2">
            <option value="new">Newest</option>
            <option value="price-asc">Price: Low → High</option>
            <option value="price-desc">Price: High → Low</option>
          </select>
        </div>
      </div>

      <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        ${prods.map(p => `
          <div class="bg-white rounded-lg shadow group">
            <a href="#/product?slug=${encodeURIComponent(p.slug)}">
              <div class="h-56 flex items-center justify-center overflow-hidden rounded-t-lg bg-gray-50">
                <img src="${p.image || '/imges/placeholder.jpg'}" alt="${escapeHtml(p.name)}" class="w-full h-full object-contain p-6" onerror="this.src='/images/placeholder.jpg'"/>
              </div>
            </a>
            <div class="p-4">
              <a href="#/product?slug=${encodeURIComponent(p.slug)}" class="font-semibold text-gray-800 hover:text-indigo-600">${escapeHtml(p.name)}</a>
              <div class="mt-2 text-sm text-gray-500">${escapeHtml((p.description||'').slice(0,80))}</div>
              <div class="mt-4 flex items-center justify-between">
                <div class="text-indigo-600 font-bold">$${Number(p.price).toFixed(2)}</div>
                <div><button data-id="${p._id}" data-name="${escapeHtml(p.name)}" data-price="${p.price}" data-image="${p.image||'/images/placeholder.jpg'}" class="add-btn inline-block bg-indigo-600 text-white px-3 py-2 rounded">Add</button></div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    </section>
  `);

  document.getElementById('sort-select')?.addEventListener('change', (e)=>{
    const v = e.target.value;
    let arr = [...prods];
    if(v === 'price-asc') arr.sort((a,b)=>a.price-b.price);
    if(v === 'price-desc') arr.sort((a,b)=>b.price-a.price);
    if(v === 'new') arr.sort((a,b)=> new Date(b.createdAt||0) - new Date(a.createdAt||0));
    document.getElementById('products-grid').innerHTML = arr.map(p => `
      <div class="bg-white rounded-lg shadow group">
        <a href="#/product?slug=${encodeURIComponent(p.slug)}">
          <div class="h-56 flex items-center justify-center overflow-hidden rounded-t-lg bg-gray-50">
            <img src="${p.image || '/images/placeholder.jpg'}" alt="${escapeHtml(p.name)}" class="w-full h-full object-contain p-6" onerror="this.src='/images/placeholder.jpg'"/>
          </div>
        </a>
        <div class="p-4">
          <a href="#/product?slug=${encodeURIComponent(p.slug)}" class="font-semibold text-gray-800 hover:text-indigo-600">${escapeHtml(p.name)}</a>
          <div class="mt-2 text-sm text-gray-500">${escapeHtml((p.description||'').slice(0,80))}</div>
          <div class="mt-4 flex items-center justify-between">
            <div class="text-indigo-600 font-bold">$${Number(p.price).toFixed(2)}</div>
            <div><button data-id="${p._id}" data-name="${escapeHtml(p.name)}" data-price="${p.price}" data-image="${p.image||'/images/placeholder.jpg'}" class="add-btn inline-block bg-indigo-600 text-white px-3 py-2 rounded">Add</button></div>
          </div>
        </div>
      </div>
    `).join('');
    attachAddButtons();
  });

  attachAddButtons();
}

async function renderProductDetail(slug){
  const p = await fetchProductBySlug(slug);
  if(!p){
    renderShell('<div class="max-w-7xl mx-auto p-8 text-center">Product not found</div>');
    return;
  }
  renderShell(`
    <main class="max-w-6xl mx-auto p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 bg-white p-6 rounded-lg shadow">
        <div class="flex items-center justify-center">
          <img src="${p.image||'/images/placeholder.jpg'}" id="detail-image" class="w-full h-[420px] object-contain rounded-lg" onerror="this.src='/images/placeholder.jpg'"/>
        </div>
        <div>
          <h1 id="detail-name" class="text-3xl font-bold">${escapeHtml(p.name)}</h1>
          <div id="detail-price" class="text-2xl text-indigo-600 font-extrabold mt-4">$${Number(p.price).toFixed(2)}</div>
          <p id="detail-desc" class="text-gray-600 mt-4">${escapeHtml(p.description||'')}</p>

          <div class="mt-6 flex items-center gap-3">
            <div class="inline-flex items-center border rounded">
              <button id="dec-btn" class="px-3 py-2">-</button>
              <div id="qty-val" class="px-4 py-2">1</div>
              <button id="inc-btn" class="px-3 py-2">+</button>
            </div>
            <button id="add-detail" class="bg-indigo-600 px-6 py-3 text-white rounded-lg">Add to Cart</button>
            <a href="#/cart" class="px-4 py-3 border rounded hover:bg-gray-50">View Cart</a>
          </div>
        </div>
      </div>
    </main>
  `);

  let qty = 1;
  const qEl = document.getElementById('qty-val');
  document.getElementById('inc-btn').addEventListener('click', ()=> { qty++; qEl.textContent = qty; });
  document.getElementById('dec-btn').addEventListener('click', ()=> { qty = Math.max(1, qty-1); qEl.textContent = qty; });
  document.getElementById('add-detail').addEventListener('click', ()=> {
    addToCartItem({ productId: p._id, name: p.name, price: p.price, image: p.image||'/images/placeholder.jpg', quantity: qty });
    renderTopCount();
  });
}

function renderCart(){
  const items = getCart();
  renderShell(`
    <main class="max-w-4xl mx-auto p-6">
      <h1 class="text-2xl font-bold mb-4">Your cart</h1>
      <div id="cart-list" class="space-y-4">${items.length ? '' : '<div class="bg-white p-6 rounded shadow text-center text-gray-600">Your cart is empty</div>'}</div>
      <div class="mt-6 bg-white p-4 rounded shadow">
        <div class="flex justify-between items-center">
          <div class="text-lg font-semibold">Total</div>
          <div id="cart-total" class="text-xl font-extrabold text-indigo-600">$${cartTotal().toFixed(2)}</div>
        </div>
        <div class="mt-4 flex gap-3">
          <a href="#/products" class="px-4 py-2 border rounded">Continue shopping</a>
          <a id="checkout-link" href="#/checkout" class="px-4 py-2 bg-indigo-600 text-white rounded">Checkout</a>
        </div>
      </div>
    </main>
  `);

  const listEl = document.getElementById('cart-list');
  if(items.length){
    listEl.innerHTML = '';
    items.forEach(it=>{
      const row = document.createElement('div');
      row.className = 'flex items-center gap-4 bg-white p-4 rounded shadow';
      row.innerHTML = `
        <img src="${it.image}" class="w-20 h-20 object-cover rounded" onerror="this.src='/images/placeholder.jpg'"/>
        <div class="flex-1">
          <div class="font-semibold">${escapeHtml(it.name)}</div>
          <div class="text-sm text-gray-500">$${Number(it.price).toFixed(2)} each</div>
          <div class="mt-2 inline-flex items-center gap-2">
            <button class="px-2 py-1 border qty-dec" data-id="${it.productId}">-</button>
            <span class="px-3">${it.quantity}</span>
            <button class="px-2 py-1 border qty-inc" data-id="${it.productId}">+</button>
            <button class="ml-4 text-red-600 remove-item" data-id="${it.productId}">Remove</button>
          </div>
        </div>
        <div class="text-right font-bold">$${(it.price * it.quantity).toFixed(2)}</div>
      `;
      listEl.appendChild(row);
    });

    listEl.querySelectorAll('.qty-dec').forEach(b => b.addEventListener('click', ()=>{
      const id = b.dataset.id; const c = getCart(); const it = c.find(x=>x.productId===id); if(!it) return; it.quantity = Math.max(1,it.quantity-1); setCart(c); renderCart();
    }));
    listEl.querySelectorAll('.qty-inc').forEach(b => b.addEventListener('click', ()=>{
      const id = b.dataset.id; const c = getCart(); const it = c.find(x=>x.productId===id); if(!it) return; it.quantity++; setCart(c); renderCart();
    }));
    listEl.querySelectorAll('.remove-item').forEach(b => b.addEventListener('click', ()=>{
      const id = b.dataset.id; removeFromCart(id); renderCart();
    }));
  }
}

function renderAuth(){
  renderShell(`
    <main class="min-h-[60vh] flex items-center justify-center p-6">
      <div class="max-w-3xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-2xl font-bold mb-4">Login</h2>
          <form id="login-form" class="space-y-3">
            <input name="email" type="email" placeholder="Email" class="w-full border rounded px-3 py-2" required />
            <input name="password" type="password" placeholder="Password" class="w-full border rounded px-3 py-2" required />
            <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded">Login</button>
          </form>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
          <h2 class="text-2xl font-bold mb-4">Create account</h2>
          <form id="register-form" class="space-y-3">
            <input name="name" placeholder="Full name" class="w-full border rounded px-3 py-2" required />
            <input name="email" type="email" placeholder="Email" class="w-full border rounded px-3 py-2" required />
            <input name="password" type="password" placeholder="Password" class="w-full border rounded px-3 py-2" required />
            <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded">Register</button>
          </form>
        </div>
      </div>
    </main>
  `);

  document.getElementById('login-form')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const body = { email: fd.get('email'), password: fd.get('password') };
    try{
      const res = await fetch(API_BASE + '/api/auth/login', { method:'POST', headers:{ 'Content-Type':'application/json' }, credentials:'include', body: JSON.stringify(body) });
      const json = await res.json();
      if(!res.ok) return alert(json.message || 'Login failed');
      showToast('Logged in');
      navigateTo('#/');
    }catch(err){ alert('Network error'); }
  });

  document.getElementById('register-form')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const body = { name: fd.get('name'), email: fd.get('email'), password: fd.get('password') };
    try{
      const res = await fetch(API_BASE + '/api/auth/register', { method:'POST', headers:{ 'Content-Type':'application/json' }, credentials:'include', body: JSON.stringify(body) });
      const json = await res.json();
      if(!res.ok) return alert(json.message || 'Register failed');
      showToast('Account created');
      navigateTo('#/');
    }catch(err){ alert('Network error'); }
  });
}

function renderCheckout(){
  const cart = getCart();
  renderShell(`
    <main class="max-w-4xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Shipping Information</h2>
        <form id="checkout-form" class="space-y-3">
          <input name="name" placeholder="Full name" class="w-full border rounded px-3 py-2" required />
          <input name="address" placeholder="Street address" class="w-full border rounded px-3 py-2" required />
          <input name="city" placeholder="City" class="w-full border rounded px-3 py-2" required />
          <input name="postalCode" placeholder="Postal code" class="w-full border rounded px-3 py-2" required />
          <input name="country" placeholder="Country" class="w-full border rounded px-3 py-2" required />
          <button class="w-full bg-indigo-600 text-white px-4 py-2 rounded">Place Order</button>
          <div id="checkout-msg" class="mt-3 text-sm text-red-600"></div>
        </form>
      </div>

      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold mb-4">Order Summary</h2>
        <div id="order-summary" class="space-y-3">
          ${cart.length ? cart.map(it => `<div class="flex justify-between"><div>${escapeHtml(it.name)} x${it.quantity}</div><div>$${(it.price*it.quantity).toFixed(2)}</div></div>`).join('') : '<div class="text-gray-500">Cart is empty</div>'}
        </div>
        <div class="mt-4 text-right">
          <div class="text-sm text-gray-500">Shipping: Free</div>
          <div class="text-2xl font-extrabold text-indigo-600" id="order-total">$${cartTotal().toFixed(2)}</div>
        </div>
      </div>
    </main>
  `);

  document.getElementById('checkout-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const address = {
      name: fd.get('name'),
      address: fd.get('address'),
      city: fd.get('city'),
      postalCode: fd.get('postalCode'),
      country: fd.get('country')
    };
    const items = getCart().map(it => ({ productId: it.productId, quantity: it.quantity }));
    if(!items.length){ document.getElementById('checkout-msg').textContent = 'Cart is empty.'; return; }
    try{
      const res = await fetch(API_BASE + '/api/orders', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        credentials: 'include',
        body: JSON.stringify({ items, shippingAddress: address })
      });
      const json = await res.json();
      if(!res.ok){
        document.getElementById('checkout-msg').textContent = json.message || 'Checkout failed';
        if(res.status === 401) document.getElementById('checkout-msg').innerHTML += ' — <a class="text-indigo-600 underline" href="#/auth">Please login</a>.';
        return;
      }
      // success
      localStorage.removeItem(CART_KEY);
      renderTopCount();
      showToast('Order placed');
      navigateTo('#/');
    }catch(err){
      console.error(err);
      document.getElementById('checkout-msg').textContent = 'Network error';
    }
  });
}

/* -------------------------
   ROUTER & init
--------------------------*/
function navigateTo(hash){
  location.hash = hash;
}

function parseHash(){
  const hash = location.hash || '#/';
  const [path, queryString] = hash.slice(1).split('?');
  const params = new URLSearchParams(queryString || '');
  return { path: path || '/', params };
}

async function handleRoute(){
  const { path, params } = parseHash();
  if(path === '/' || path === ''){ await renderHome(); }
  else if(path === '/products' || path === 'products'){ await renderProducts(); }
  else if(path === '/product' || path === 'product'){ const slug = params.get('slug'); if(slug) await renderProductDetail(slug); else renderShell('<div class="p-8 text-center">No product specified</div>'); }
  else if(path === '/cart' || path === 'cart'){ renderCart(); }
  else if(path === '/auth' || path === 'auth'){ renderAuth(); }
  else if(path === '/checkout' || path === 'checkout'){ renderCheckout(); }
  else { renderShell('<div class="p-8 text-center">Not found</div>'); }
  attachCommonBindings();
}

/* attach add buttons after product html injection */
function attachAddButtons(){
  document.querySelectorAll('.add-btn').forEach(b=>{
    b.addEventListener('click', ()=>{
      const id = b.dataset.id;
      const name = b.dataset.name;
      const price = parseFloat(b.dataset.price||0) || 0;
      const image = b.dataset.image || '/images/placeholder.jpg';
      addToCartItem({ productId: id, name, price, image, quantity: 1 });
      renderTopCount();
    });
  });
}

/* bind search / mobile menu etc */
function attachCommonBindings(){
  // global search (on navbar)
  const search = document.getElementById('global-search');
  if(search){
    search.onkeydown = async (e) => {
      if(e.key === 'Enter'){
        e.preventDefault();
        const q = search.value.trim().toLowerCase();
        const all = await fetchProducts();
        const matched = all.filter(p => (p.name||'').toLowerCase().includes(q) || (p.description||'').toLowerCase().includes(q));
        // render simple search results in products grid
        if(location.hash !== '#/products') navigateTo('#/products');
        setTimeout(()=> {
          const grid = document.getElementById('products-grid');
          if(grid) grid.innerHTML = matched.map(p => `
            <div class="bg-white rounded-lg shadow group">
              <a href="#/product?slug=${encodeURIComponent(p.slug)}">
                <div class="h-56 flex items-center justify-center overflow-hidden rounded-t-lg bg-gray-50">
                  <img src="${p.image || '/images/placeholder.jpg'}" alt="${escapeHtml(p.name)}" class="w-full h-full object-contain p-6" onerror="this.src='/images/placeholder.jpg'"/>
                </div>
              </a>
              <div class="p-4">
                <a href="#/product?slug=${encodeURIComponent(p.slug)}" class="font-semibold text-gray-800 hover:text-indigo-600">${escapeHtml(p.name)}</a>
                <div class="mt-2 text-sm text-gray-500">${escapeHtml((p.description||'').slice(0,80))}</div>
                <div class="mt-4 flex items-center justify-between">
                  <div class="text-indigo-600 font-bold">$${Number(p.price).toFixed(2)}</div>
                  <div><button data-id="${p._id}" data-name="${escapeHtml(p.name)}" data-price="${p.price}" data-image="${p.image||'/images/placeholder.jpg'}" class="add-btn inline-block bg-indigo-600 text-white px-3 py-2 rounded">Add</button></div>
                </div>
              </div>
            </div>
          `).join(''); attachAddButtons();
        }, 120);
      }
    };
  }

  // mobile menu toggle
  document.getElementById('mobile-menu-btn')?.addEventListener('click', ()=>{
    document.getElementById('mobile-menu')?.classList.toggle('hidden');
  });

  // update top cart count
  renderTopCount();
}

/* top count */
function renderTopCount(){
  const count = getCart().reduce((s,i)=>s+i.quantity,0);
  document.getElementById('top-count').textContent = count;
  const els = document.querySelectorAll('#top-count');
  els.forEach(e=> e.textContent = count);
}

/* initial boot */
window.addEventListener('hashchange', handleRoute);
document.addEventListener('DOMContentLoaded', async ()=>{
  document.getElementById('year').textContent = new Date().getFullYear();
  await handleRoute();
  attachCommonBindings();
});

</script>
</body>
</html>
